Hipo：去中心化债券协议（Decentralized Bond Protocol）
================================================

# 摘要

在传统金融中，通过发行债券进行借贷是非常重要而且高效的融资方式，```Hipo```是第一个在DEFI生态上实现固定期限固定利率债券借贷的去中心化协议，相比于现有的资金池借贷模式，```Hipo```能够大幅提升资金效率，有效分散借贷风险。同时，基于``Hipo``的借贷机制，能够在市场充分博弈基础上产生更加有效的固定利率以及固定收益产品，让市场参与者受益以及满足不同风险偏好投资人的投资需求。

*******



# 1 Hipo介绍

Hipo是一个运行在以太坊上的去中心化债券协议（Decentralized bond protocol）。基于Hipo可以抵押数字资产发行固定期限固定利率的债券，并且通过债券交易市场交易债券后完成借贷。  

债券交易市场也是Hipo协议的重要组成部分，基于自动做市商原理（AMM）进行构建，并且对包含时间周期属性的债券交易，进行了针对性的优化。债券交易市场为债券发行人和债券投资者提供了充足的流动性以及更有效的利率价格形成机制。  

*******

# 2 债券发行

Hipo V1接受Uniswap和Sushi上ETH/USDC、ETH/DAI、ETH/USDT交易池的LP Token作为抵押资产发行对应的ETH、USDC、DAI、USDT债券用于债券借贷。  

*******

# 举例
## 说明
> 用户Bob持有Uniswap ETH/USDT交易池的LP Token，假设按照当前时刻ETH价格为2000USDT计算，Bob持有的LP Token总价值为1000USDT（不包括交易手续费分成），ETH和USDT的数量分别为：0.25ETH、500USDT。
 
> ###### 表2-1 Bob持有的LP Token
> | Token      |    Qt.  | Value(USDT)   |
> | :--------- |  ------:| :----------:  |
> | ETH        |   0.25  |  500          |
> | USDT       |   500   |  500          |  
  
> 现在Bob将持有的LP Token抵押入Hipo协议，可以生成```“30天USDT债券”```用于借贷，最大借贷抵押率为```80%```，清算线为```90%```，也就是说最多可以生成800份30天到期，面值为1USDT的零息债券，债券到期时（30天后），持有债券的投资人可以获得800USDT。  

> Bob也可以将这些LP Token抵押入Hipo协议，选择生成30天ETH债券，每份债券的面值为1ETH。ETH债券的数量为0.2份。

> Bob在抵押生成债券时，需要支付债券发行费，费率为0.2%，使用发行债券借贷的币种对应的币种进行支付。例如，发行的债券为30天USDT债券，那么发行费就需要用USDT支付。Bob发行债券支付的债券发行费保存在30天USDT债券发行费资金池中。  

> Bob通过Hipo协议抵押LP Token成功发行债券后，Bob将持有代表相应零息债券的Token（记作：b30USDT，代表30天到期，每份面值为1USDT的USDT零息债券，债券到期后，每份债券可按照面值兑换相应数量的USDT），共计800份，此时债券还未完成借贷，属于未激活债券。未激活债券不计息，不按照债券周期进行倒计时。 


## Bob发行债券示意图

![image](https://user-images.githubusercontent.com/82855877/119930267-b4e5ae80-bfb1-11eb-919f-73cf2c56f0b8.png)

  

                    
## 示例总结

* 抵押Uniswap LP Token发行债券，可发行债券数量按照LP Token价值进行计算。
* 发行债券需要支付债券发行费。
* 成功发行的债券为“未激活债券”，不计息，不倒计时。

                    
## 常见问题

1. Bob发行的“未激活债券”是否可以直接解除抵押，取回自己的抵押物LP Token？
* 可以，但不退还债券发行费。  

*******

# 3 债券交易
## 3.1 债券交易市场

债券交易市场由两部分组成：采用AMM机制的利率交易池和借贷资金池。  

###### 图3-1 Hipo债券交易市场
![image](https://user-images.githubusercontent.com/82855877/119838122-bbcedb80-bf35-11eb-9811-eececbba5fbc.png)


## 3.2 利息Token
### 1.利息Token定价
利息Token是Hipo协议通过铸币的方式生成的符合ERC20标准的代币，利息Token关联资产是债券到期后的利息。1份债券对应1份利息Token。利息Token和债券数量、借贷资产数量之间具有以下关系：

`` 借贷资产数量`` + ``利息币数量`` × ``利息币价格`` = ``债券数量`` × ``债券面值 ``  
``利息币数量`` = ``债券数量``

> 例如，现在有1000份期限为30天的USDT零息债券，面值为1USDT，与这1000份利息币对应的就有1000份30天USDT债券的利息币。债券购买时的价格为0.97USDT/份，持有这1000份债券至到期日可获得1000USDT，购买时支付的本金为970USDT，可获得的利息为30USDT，那么利息币的价格为0.03USDT/份。  

利息币的价格决定了债券的价格，利息币通过AMM的交易池进行交易（如上图所示，交易池的交易币对为：```利息Token ``` / ``` USDT```）的价格由AMM交易池通过市场供需关系进行定价。当前市场上债券的价格为：  

``债券价格`` =``1`` - ``利息币价格``  

债券的利率为：

``利率`` = (``利息币价格`` / ``债券价格``) × (``365`` / ``债券周期``)  


### 2.生成利息Token
在债券交易市场购买债券生成利息Token，生成的利息Token数量等于购买债券的数量。
> 例如，在Hipo债券交易市场上，购买1000份30天USDT债券，Hipo会生成1000份利息Token。

### 3.购买利息Token
持有“未激活状态债券”可以通过Hipo债券交易市场购买利息Token，用于支付利息并激活债券，可购买的利息Token数量与“未激活状态债券”的数量相等。
> 例如，发行1000份30天USDT债券，债券还未激活，可以通过Hipo的债券交易市场购买1000份利息Token，用于支付债券利息，激活债券，完成借贷。

## 举例

> Tom通过抵押Uniswap的ETH/USDT LP Token发行了1000份30天USDT零息债券，债券的面值为1USDT/份。现在Tom要通过```Hipo债券交易市场```卖出1000份债券，借贷USDT。按照```Hipo债券交易市场```的交易机制，Tom只有同时持有1000份债券和相应的利息Token才能从```借贷资金池```借出USDT。  

> 第一步，Tom通过```30天USDT债券利息Token交易池```购买1000份利息Token，交易池采取AMM的交易机制。假设当前时刻交易池交易币对的数量如下表所示：
> ###### 表3-1 ```30天USDT债券利息Token交易池```
> | 利息Token数量     |    USDT数量  | 利息Token价格   |
> | :--------- |  ------:| :----------:  |
> | 1000,000.00 |  10000.00 |  0.01000USDT          |


> 购买1000枚利息Token后：
> ###### 表3-2 Tom购买后```30天USDT债券利息Token交易池```
> | 利息Token数量    |    USDT数量  | 利息Token价格   |
> | :--------- |  ------:| :----------:  |
> | 999,000 |  10,010.01001 |  0.01001USDT          |  


> Tom购买1000枚利息Token需要支付10.01001USDT以及0.03003USDT的手续费（交易手续费费率为0.03%）。  
> Tom购买利息Token的价格为(不含交易手续费)：  
> 10.01001/1000=0.01001USDT  
> 那么，债券的价格为：  
> 1-0.01001=0.98999USDT  
> Tom将1000份债券和1000枚利息Token一起，在债券市场获得USDT的贷款，可获得的USDT贷款的数量为：  
> 0.98999*1000=989.99USDT  
> Tom从借贷资金池借出USDT需支付手续费，手续费费率为0.1%，即：
> 989.99USDT*0.1%=0.98999USDT
> 从借出资金中扣除手续费，Tom实际得到USDT为：
> 989.99-0.98999=989.0001USDT
> 从交易完成时刻起开始计息，并在30天后归还本金。  

## 示例总结
涉及的Token：
* 零息债券（未激活状态）：通过Hipo协议抵押资产生成，相关参数包括借贷抵押率。
* 利息Token：用来计算债券利息的Token，价格决定了债券的价格，也就是决定了借贷的利率。
* 债券偿还Token：债券发行人卖出债券后获得，计算利息并有到期日，债券到期时还回本金，并用```债券尝还Token```换回```零息债券（未激活状态）```，进而解除抵押品质押。

Tom使用债券借贷流程：
* 发行并持有未激活的零息债券。
* 通过AMM市场购买利息Token。
* 使用```未激活债券```+```利息Token```从借贷资金池借出相应的USDT。
* 持有```债券偿还Token```，在到期日偿还本金，换回未激活的零息债券，进而解除抵押品质押。


## 常见问题

（无）

## 3.3 卖出债券进行借贷
### 1.交易流程

已发行的债券，为“未激活状态”的债券，需要通过Hipo的债券交易市场进行交易，才能完成借贷。交易流程如下：
* 通过AMM交易机制的利息Token交易池，购买与持有的未激活状态的债券数量相同的利息Token，支付交易手续费，交易手续费费率为0.3%。
* 将利息Token和持有的未激活状态的债券抵押进托管池，同时从借贷资金池中借出资金，交易手续费为借出资金总额的0.1%，从借出资金中扣减。
* 完成交易的债券以当前时刻开始计息，并以当前时刻为起点确定债券到期日。
### 2.债券价格及利率
债券价格为：  

```债券价格```=```1```-```利息Token价格```  

其中，利息Token价格为平均成交价格：  

```利息Token价格```=```购买利息Token时支出的资产总额```/```利息Token数量```  

债券的利率为：  

利率=(```利息币价格```/```债券价格```)×(```365```/```债券周期```)  

## 3.4 买入债券进行投资
### 1.交易流程

债券投资者可以通过```Hipo债券交易市场```买入债券并持有到期获取利息收益。交易流程如下：
* 根据要购买的债券数量，生成相应数量的利息Token。
* 如果将利息Token在AMM机制的利息Token交易池中交易，会生成利息Token的平均交易价格（并未实际交易，只是为了获得利息Token的实际价格）。
### 2.债券价格及利率
债券价格为：  

```债券价格```=```1```-```利息Token价格```  

其中，利息Token价格为平均成交价格：  

```利息Token价格```=```购买利息Token时支出的资产总额```/```利息Token数量```  

债券的利率为：  

利率=(```利息币价格```/```债券价格```)×(```365```/```债券周期```)  

## 举例

> Lisa打算通过```Hipo债券交易市场```购买债券进行投资，获得固定收益，Lisa选择了30天USDT债券作为投资标的，投资数量为2000份。Lisa和Hipo协议的操作和交互如下所示：  


> 如果购买债券数量为```2000份```，Hipo将会相应生成```2000份利息Token```并通过AMM利息Token交易池进行交易，假设如果完成交易可获得22USDT，那么当前时刻，利息Token的平均成交价格为：  


> ```22USDT``` / ```2000``` = ```0.011USDT```  


> 那么，当前时刻，债券的价格为：  


> 1-0.011=0.989USDT  


> 此时，Lisa确定购买，则向```借贷资金池```存入```0.989*2000=1978USDT```,同时通过交易2000份利息Token，从AMM利息Token交易池拿出22USDT存入利息托管池。  


> Lisa需支付的交易费为：22USDT*0.003+1978*0.001=2.044USDT，2.044USDT从22USDT中扣除。  


> Lisa持有债券到期（30）天可获得的年化收益率(APY)为：（0.011/0.989）*（365/30）=13.53%  


> 扣除交易手续费，Lisa持有债券到期（30）天可获得的年化收益率(APY)为：（0.011-（2.044/2000）/0.989）*（365/30）=12.27%  



## 实例总结
* Lisa购买债券进行投资，需要先根据Lisa购买数量实时计算债券价格。
* 依据债券价格确定Lisa需存入借贷资金池的资金数量。
* 依据购买的债券数量，按照1：1的比例生成利息Token，并通过AMM的利息Token交易池进行交易，获得持有债券的利息，将利息存入利息托管池。
* Lisa的交易需支付交易手续费，交易手续费包括两部分：AMM利息Token交易池交易手续费，费率0.03%；存入借贷资金池手续费，费率0.01%。


## 3.5 未到期债券赎回
通过Hipo协议发行债券进行借贷，是固定周期固定利率的借贷产品，需要在债券到期日进行赎回。如果在债券未到期时赎回，交易流程如下：
* 添加借贷凭证，并放入借贷金额，获得未激活状态的债券。
* 使用未激活状态的债券解除质押，取回质押物。

## 3.6 未到期债券卖出
通过Hipo债券购买的债券，是固定周期固定利率的借贷产品，需要在债券到期日进行交割。持有债券的投资人在债券未到期时需要拿会本金，可以通过Hipo债券交易市场进行交易，交易流程如下：
* 根据债券已持有的时间结算“可结算利息”。
* 通过Hipo协议重新发行相应周期的债券，并通过债券交易市场卖出债券，拿回相应的本金。

# 4 清算机制
（略）
